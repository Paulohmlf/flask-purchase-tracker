{% extends "base.html" %}

{% block content %}
<div class="card" style="max-width: 800px; margin: 0 auto;">
    <div style="display: flex; justify-content: space-between;">
        <h2>Atualizar Pedido #{{ pedido.id }}</h2>
        <a href="{{ url_for('dashboard') }}" style="color: red;">Cancelar</a>
    </div>
    
    <form method="POST" enctype="multipart/form-data">
        <div style="background-color: #f8f9fa; padding: 10px; margin-bottom: 20px;">
            <label>Status Atual:</label>
            <select name="status">
                <option value="Aguardando AprovaÃ§Ã£o" {% if pedido.status_compra == 'Aguardando AprovaÃ§Ã£o' %}selected{% endif %}>Aguardando AprovaÃ§Ã£o</option>
                <option value="Enviado ao Fornecedor" {% if pedido.status_compra == 'Enviado ao Fornecedor' %}selected{% endif %}>Enviado ao Fornecedor</option>
                <option value="Confirmado" {% if pedido.status_compra == 'Confirmado' %}selected{% endif %}>Confirmado</option>
                <option value="Em TrÃ¢nsito" {% if pedido.status_compra == 'Em TrÃ¢nsito' %}selected{% endif %}>Em TrÃ¢nsito</option>
                <option value="Entregue Parcialmente" {% if pedido.status_compra == 'Entregue Parcialmente' %}selected{% endif %}>Entregue Parcialmente</option>
                <option value="Entregue Totalmente" {% if pedido.status_compra == 'Entregue Totalmente' %}selected{% endif %}>Entregue Totalmente</option>
            </select>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div>
                <label>NÂº SolicitaÃ§Ã£o:</label><input type="text" name="solicitacao" value="{{ pedido.numero_solicitacao }}" required>
                <label>NÂº OrÃ§amento:</label><input type="text" name="orcamento" value="{{ pedido.numero_orcamento or '' }}">
                <label>NÂº Pedido:</label><input type="text" name="pedido" value="{{ pedido.numero_pedido or '' }}">
                <label>Item:</label><input type="text" name="item" value="{{ pedido.item_comprado }}" required>
                <label>Fornecedor:</label><input type="text" name="fornecedor" value="{{ pedido.fornecedor }}" required>
            </div>
            <div>
                <label>Data da Compra:</label><input type="date" name="data_compra" value="{{ pedido.data_compra or '' }}">
                <label>Prazo de Entrega (Original):</label><input type="date" name="prazo" value="{{ pedido.prazo_entrega or '' }}">
                <label>Data Reprogramada (Se houver atraso):</label><input type="date" name="reprogramada" value="{{ pedido.data_entrega_reprogramada or '' }}">
                
                <hr style="margin: 15px 0; border: 0; border-top: 1px solid #eee;">

                <label style="color: #2980b9;">Anexo (PDF/Foto):</label>
                {% if pedido.arquivo_anexo %}
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                        <a href="{{ url_for('static', filename='uploads/' + pedido.arquivo_anexo) }}" target="_blank" style="font-weight: bold;">ðŸ“Ž Ver Atual</a>
                        
                        <a href="{{ url_for('excluir_anexo', id=pedido.id) }}" onclick="return confirm('Apagar apenas o arquivo anexo?')" style="text-decoration: none;">
                            <span style="background: #e74c3c; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.8em; cursor: pointer;">X Remover</span>
                        </a>
                    </div>
                {% endif %}
                <input type="file" name="arquivo">

                <hr style="margin: 15px 0; border: 0; border-top: 1px solid #eee;">

                <label>Fiscal:</label><input type="text" name="nota" value="{{ pedido.nota_fiscal or '' }}">
                <label>SÃ©rie:</label><input type="text" name="serie" value="{{ pedido.serie_nota or '' }}">
            </div>
        </div>
        <button type="submit" style="width: 100%; margin-top: 30px; background: #27ae60;">Salvar AlteraÃ§Ãµes</button>
    </form>
</div>
{% endblock %}